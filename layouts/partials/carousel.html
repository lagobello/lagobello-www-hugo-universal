{{ if default true .Site.Params.CarouselHomepage.enable }}
<!-- DEBUG: Carousel Enabled -->
{{ $lots := transform.Unmarshal (os.ReadFile "static/data/lots.json") }}
{{ if $lots }}
<!-- DEBUG: Lots Data Found -->
{{ $listed_lots := where $lots "Lot Status" "Listed" }}
<!-- DEBUG: Listed Lots Count: {{ len $listed_lots }} -->
{{ if gt (len $listed_lots) 0 }}
<section>
    <div class="home-carousel"
        style="background-image: url('img/lago-gate-2025-cropped.jpg'); background-size: cover; background-position: center;">
        <div class="dark-mask" style="background: rgba(50, 50, 50, 0.8);"></div>
        <div class="container">
            <div class="homepage owl-carousel"
                data-autoplay="{{ default true .Site.Params.CarouselHomepage.auto_play }}" data-slide-speed="4000"
                data-pagination-speed="{{ default 1000 .Site.Params.CarouselHomepage.pagination_speed }}">
                {{ range $listed_lots }}
                <div class="item">
                    {{ $url := printf "/lots/%s/" (.Name | urlize) }}
                    <div class="row">
                        <div class="col-sm-5 right">
                            <h1><a href="{{ $url }}" style="text-decoration: none; color: inherit;">{{ .Name }}</a></h1>
                            <div class="content">
                                {{ $size := index . "Size [sqft]" }}
                                {{ $closeTo := index . "Close-to" }}
                                <p class="lead" style="margin-bottom: 20px;">
                                    Build Your {{ if or (eq $closeTo "Lake") (eq $closeTo "Canal") }}Waterfront
                                    Dream{{ else }}Dreamhouse{{ end }} in {{ .Subdivision }} â€“ Over {{ printf "%.0f"
                                    (float (default 0 $size)) }} Sq. Ft.
                                </p>

                                <p class="author-category">
                                    {{ if index . "List Price" }}
                                    <span style="font-weight: bold; font-size: 1.5em; color: #ffffff;">${{
                                        printf "%.0f" (float (default 0 (index . "List Price"))) }}</span>
                                    {{ else }}
                                    <span class="text-muted">Price upon request</span>
                                    {{ end }}
                                </p>
                                <p>
                                    <a href="{{ $url }}" class="btn btn-template-main">View Details</a>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-7">
                            {{ $streetViewUrl := "" }}
                            {{ $location := index . "Location" }}
                            {{ if and $location $.Site.Params.googleMapsApiKey }}
                            {{ $coords := split $location ", " }}
                            {{ if eq (len $coords) 2 }}
                            {{ $lat := index $coords 0 }}
                            {{ $lng := index $coords 1 }}
                            {{ $streetViewUrl = printf
                            "https://maps.googleapis.com/maps/api/streetview?size=600x400&location=%s,%s&fov=90&pitch=0&return_error_code=true&key=%s"
                            $lat $lng $.Site.Params.googleMapsApiKey }}
                            {{ end }}
                            {{ end }}

                            {{ $firm := index . "Listing Firm" }}
                            {{ $logo := "" }}
                            {{ if $firm }}
                            {{ $firmLower := lower $firm }}
                            {{ if in $firmLower "coldwell banker" }}
                            {{ $logo = "coldwell-banker-logo.svg" }}
                            {{ else if in $firmLower "keller williams" }}
                            {{ $logo = "keller-williams-logo.svg" }}
                            {{ else if in $firmLower "liz realty" }}
                            {{ $logo = "liz-realty-logo.jpg" }}
                            {{ else if in $firmLower "spi realty" }}
                            {{ $logo = "spi-realty-logo.png" }}
                            {{ end }}
                            {{ end }}

                            <div style="position: relative; padding: 25px;">
                                <div style="position: relative; width: 80%; margin-left: 60px;">
                                    <div class="custom-ribbon"
                                        style="position: absolute; top: 20px; right: -10px; background-image: url('/img/red-banner.png'); background-size: cover; background-position: center; color: white; padding: 15px 40px; font-weight: 900; z-index: 20; text-transform: uppercase; letter-spacing: 0.15em; font-size: 1.2em; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 80%, 0% 100%); box-shadow: 0 5px 15px rgba(0,0,0,0.4);">
                                        FOR SALE
                                    </div>

                                    {{ $slug := .Name | urlize }}
                                    {{ $localImg := printf "img/lots/%s.jpg" $slug }}
                                    {{ $hasLocalImg := fileExists (printf "static/%s" $localImg) }}

                                    <a href="{{ $url }}" title="{{ .Name }}">
                                        {{ if $hasLocalImg }}
                                        <img class="img-responsive"
                                            style="box-shadow: 5px 5px 15px rgba(0,0,0,0.3); max-height: 450px; width: 100%; object-fit: cover; border: 10px solid white;"
                                            src="/{{ $localImg }}" alt="{{ .Name }}">
                                        {{ else }}
                                        <img class="img-responsive"
                                            style="box-shadow: 5px 5px 15px rgba(0,0,0,0.3); max-height: 450px; width: 100%; object-fit: cover; border: 10px solid white;"
                                            src="{{ if $streetViewUrl }}{{ $streetViewUrl }}{{ else }}img/placeholder-home.png{{ end }}"
                                            alt="{{ .Name }}"
                                            onerror="this.onerror=null;this.src='img/placeholder-home.png';">
                                        {{ end }}
                                    </a>

                                    {{ if $logo }}
                                    <div
                                        style="position: absolute; bottom: 20px; right: 20px; z-index: 10; background-color: rgba(255,255,255,0.9); padding: 5px; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                                        <img src="/img/realtors/{{ $logo }}" alt="{{ $firm }}"
                                            style="height: 40px; width: auto;">
                                    </div>
                                    {{ end }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
            <!-- /.project owl-slider -->
        </div>
    </div>
</section>
{{ else }}
<!-- DEBUG: No Listed Lots Found -->
{{ end }}
{{ else }}
<!-- DEBUG: Lots Data NOT Found -->
{{ end }}
{{ end }}